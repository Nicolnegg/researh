#!/usr/bin/env python3
# ----------------------------------------
import sys
# ---------------------------------------
from seatic.plots import generate_survival_plot
from colorama import Fore, Style
# ---------------------------------------
def figsize_param(strp):
    parts = strp.split(',')
    return int(parts[0]), int(parts[1])
# ---------------------------------------
def parse_series(files, rmzeros=False):
    series = []
    labels = []
    for filename in files:
        serie = []
        label = None
        with open(filename) as stream:
            for line in stream:
                line = line.replace('[0m', '')
                line = line.replace('\x8d', '')
                line = line.replace('\x1b', '')
                if line.startswith('label:'):
                    label = line.strip().replace('label:', '')
                else:
                    if rmzeros and line.strip() == '0':
                        pass
                    else:
                        serie.append(float(line.strip()))
        series.append(serie)
        labels.append(label)
    return series, labels
# ---------------------------------------
def main(args):
    series, labels = parse_series(args.series, args.remove_zeros)
    generate_survival_plot(series, args.title, args.output, labels=labels, figsize=figsize_param(args.figsize), exlegend=args.legend)
# ----------------------------------------
# ----------------------------------------
if __name__ == '__main__':
    from argparse import ArgumentParser

    ap = ArgumentParser(description='')

    g1 = ap.add_argument_group('Core options')
    g1.add_argument('-o', '--output', action='store', default='survival.pdf', metavar='<output>', help='output graph')
    g1.add_argument('-t', '--title', action='store', default=None, metavar='<title>', help='graph title')
    g1.add_argument('-i', '--series', action='store', nargs='+', metavar='<time-serie>', default=[], help='input time series')
    g1.add_argument('--figsize', action='store', default='5,5', metavar='<size,size>', help='figure size')
    g1.add_argument('-l', '--legend', action='store', default=None, metavar='<legend-output>', help='external file to export legend to')
    g1.add_argument('--remove-zeros', action='store_true', help='remove 0 lines')

    args = ap.parse_args()

    try:
        main(args)
    except Exception as e:
        #TODO Log
        raise e
        sys.exit(1)
    sys.exit(0)
