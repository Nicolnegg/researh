#!python
# ----------------------------------------
import sys
import argparse
from argparse import ArgumentParser
from pulseutils.logging import Logger
import pyabduction.minibinsec as minibinsec
# ----------------------------------------
def main(args):
    logger = Logger(level=4 if args.debug else 3, color=args.log_color, log_progress=args.log_progress)
    constraint = args.constraint.split(';')
    logger.info('constraint is {}'.format(constraint))
    memory = eval(args.memory)
    logger.info('memory is {}'.format(memory))
    result = minibinsec.sat(constraint, memory)
    logger.result('constraint is {}'.format('sat' if result else 'unsat'))
# ----------------------------------------
if __name__ == '__main__':
    ap = ArgumentParser(description='Minimal Constraint SAT Solver')

    gg = ap.add_argument_group('I/Os options')
    gg.add_argument('-d', '--debug', action='store_true', help='print debug messages')
    gg.add_argument('--no-color', action='store_false', dest='log_color', help='no colors in log')
    gg.add_argument('--no-progress', action='store_false', dest='log_progress', help='no progress in log')
    gg.add_argument('--no-stats', action='store_false', dest='log_stats', help='no statistics in log')
    gg.add_argument('-c', '--constraint', action='store', metavar='<constraint>', help='constraint to check-sat')
    gg.add_argument('-m', '--memory', action='store', metavar='<memory>', default='None', help='memory to check-sat with')

    bg = ap.add_argument_group('Solver options')

    cg = ap.add_argument_group('Candidate generation options')

    args = ap.parse_args()

    try:
        main(args)
    except Exception as e:
        raise e
        sys.exit(1)
    sys.exit(0)
# ----------------------------------------
